---
permalink: upgrade/upgrade-ontap-tools.html 
sidebar: sidebar 
keywords: upgrade 
summary: A atualização é suportada para implantações HA e não HA. 
---
= Atualização das ONTAP tools for VMware vSphere 10.x para 10.4
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Você pode atualizar as ONTAP tools for VMware vSphere 10.2 ou 10.3 para 10.4. No entanto, a atualização direta das ferramentas ONTAP 10.0 ou 10.1 para 10.4 não é suportada.

OBSERVAÇÃO:

* Em sistemas ASA r2, você deve atualizar para as ONTAP tools for VMware vSphere 10.4 com ONTAP 9.16.1 antes de adicionar mais zonas de disponibilidade de armazenamento (SAZs).
* Se a atualização das ONTAP tools for VMware vSphere 10.2 ou 10.3 para a versão 10.4 falhar, a reversão não será suportada.  Para recuperar a configuração, use o RPO para ONTAP tools for VMware vSphere 10.2 e o RPO quase zero ou a recuperação de instantâneo para ONTAP tools for VMware vSphere 10.3.


.Antes de começar
Para uma atualização sem HA, desligue a VM das ferramentas ONTAP e, para uma atualização de HA, desligue o nó de gerenciamento das ferramentas ONTAP antes de fazer as seguintes alterações nas configurações da máquina virtual (VM).

Se você estiver atualizando a partir das ONTAP tools for VMware vSphere 10.2 ou 10.3, precisará concluir as seguintes etapas antes de prosseguir com a tarefa de atualização: * Adicione um disco rígido adicional de 100 GB a cada nó, pois os dados do serviço são armazenados localmente na VM. * Altere a CPU e a memória da VM desligada de acordo com a sua implantação. Habilite o plugin ativo para CPU e RAM.

+

|===
| Tipo de implantação | CPU(núcleo) por nó | Memória (GB) por nó | Espaço em disco (GB) por nó | CPU total (núcleo) | Memória (GB) | Espaço total em disco (GB) 


| Pequeno não HA | 9 | 18 | 350 | 9 | 18 | 350 


| Meio sem HA | 13 | 26 | 350 | 13 | 26 | 350 


| HA Pequeno | 9 | 18 | 350 | 27 | 54 | 1050 


| HA Médio | 13 | 26 | 350 | 39 | 78 | 1050 


| HA Grande | 17 | 34 | 350 | 51 | 102 | 1050 
|===
* Ligue a VM após as alterações serem feitas e aguarde até que os serviços entrem em estado de execução.
* No caso de implantação de HA, faça as alterações de recursos, habilite o plugin ativo para CPU e RAM e adicione discos rígidos de 100 GB para o segundo e o terceiro nó também.  Não há necessidade de reinicializar esses nós.
* Se o dispositivo foi implantado como um caminho local (implantação fácil) com as ferramentas ONTAP 10.2, você precisa fazer um snapshot de inatividade antes de atualizar.


Se você estiver atualizando das ONTAP tools for VMware vSphere 10.0 para 10.1, precisará concluir as seguintes etapas antes de prosseguir com a tarefa de atualização: *Habilitar diagnóstico*

. No vCenter Server, abra um console para ferramentas ONTAP .
. Efetue login como usuário de manutenção.
. Digite *4* para selecionar *Suporte e Diagnóstico*.
. Digite *2* para selecionar *Ativar acesso de diagnóstico remoto*.
. Digite *y* para definir a senha de sua escolha.
. Efetue login no endereço IP da VM a partir do terminal/putty com o usuário 'diag' e a senha que foi definida na etapa anterior.


*Faça um backup do MongoDB*

Execute os seguintes comandos para fazer um backup do MongoDB:

* kn exec -it ntv-mongodb-0 sh - kn é um alias de kubectl -n ntv-system.
* Execute o comando _env | grep MONGODB_ROOT_PASSWORD_ dentro do pod.
* Execute o comando _exit_ para sair do pod.
* Execute o comando _kn exec ntv-mongodb-0 --mongodump -u root -p MONGODB_ROOT_PASSWORD --archive=/tmp/mongodb-backup.gz --gzip_ para substituir o conjunto MONGO_ROOT_PASSWORD do comando acima.
* Execute o comando _kn cp ntv-mongodb-0:/tmp/mongodb-backup.gz ./mongodb-backup.gz_ para copiar o backup do MongoDB criado usando o comando acima do pod para o host.


*Tire uma foto instantânea de todos os volumes*

* Execute o comando 'kn get pvc' e salve a saída do comando.
* Faça snapshots de todos os volumes, um por um, usando um dos seguintes métodos:
+
** Na CLI, execute o comando _volume snapshot create -vserver <vserver_name> -volume <volume_name> -snapshot <snapshot_name>_
** Na interface do usuário do ONTAP System Manager, pesquise o volume pelo nome na barra de pesquisa e abra o volume selecionando o nome.  Vá para o snapshot e adicione o snapshot desse volume.




*Faça o snapshot das ONTAP tools for VMware vSphere no vCenter (3 VMs no caso de implantação de alta disponibilidade, 1 VM no caso de implantação sem alta disponibilidade)*

* Na interface de usuário do cliente vSphere, selecione a VM.
* Vá para a aba de instantâneos e selecione o botão *Tirar instantâneo*.  Tire um instantâneo inativo da VM.  Consulte https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/take-snapshots-of-a-virtual-machine.html["Faça um instantâneo de uma máquina virtual"^] para mais detalhes.


Antes de executar a atualização, exclua os pods concluídos do pacote de log com o prefixo “generate-support-bundle-job”.  Se a geração do pacote de suporte estiver em andamento, aguarde sua conclusão e exclua o pod.

Para qualquer tipo de atualização, você precisa adicionar uma unidade de disco rígido (HDD) adicional de 100 GB.  Para adicionar um HDD, execute a seguinte tarefa.

. Selecione a VM na configuração de nó único ou todas as três VMs na configuração HA.
. Clique com o botão direito do mouse na(s) VM(s) e selecione *Adicionar novo dispositivo* > *Disco rígido*
. Adicione um HDD de 100 GB no campo *Novo disco rígido*.
. Selecione *Aplicar*


Após adicionar o disco rígido, atualize os recursos da VM para as respectivas configurações e reinicie a VM primária.

Um novo HDD será criado.  O provisionador de armazenamento dinâmico usa este HDD para gerar ou replicar os volumes.

.Passos
. Carregue ONTAP tools for VMware vSphere para biblioteca de conteúdo.
. Na página principal da VM, selecione *Ações* > *Editar configurações*
. Selecione o arquivo ISO da biblioteca de conteúdo na janela de edição de configurações no campo *Unidade de CD/DVD*.
. Selecione o arquivo ISO e selecione *OK*.  Selecione a caixa de seleção conectada no campo *Unidade de CD/DVD*.image:../media/primaryvm-edit-settings.png["Editar configurações"]
. No vCenter Server, abra um console para ferramentas ONTAP .
. Efetue login como usuário de manutenção.
. Digite *3* para selecionar o menu Configuração do Sistema.
. Digite *7* para selecionar a opção de atualização.
. Ao atualizar, as seguintes ações são executadas automaticamente:
+
.. Atualização de certificado
.. Atualização remota do plug-in




Após atualizar para as ONTAP tools for VMware vSphere 10.4, você pode:

* Desabilitar os serviços da interface do usuário do gerenciador
* Migrar de uma configuração sem HA para uma configuração com HA
* Aumente a escala de uma configuração pequena não HA para uma configuração média não HA ou para uma configuração média ou grande HA.
* No caso de uma atualização não HA, reinicie a VM das ferramentas ONTAP para refletir as alterações. No caso de uma atualização de HA, reinicie o nó de gerenciamento de ferramentas ONTAP para refletir as alterações no nó.


.O que vem a seguir
Após atualizar as versões anteriores das ONTAP tools for VMware vSphere para 10.4, verifique novamente os adaptadores SRA para verificar se os detalhes estão atualizados na página Adaptadores de replicação de armazenamento do VMware Live Site Recovery.

Após a atualização bem-sucedida, exclua os volumes Trident do ONTAP manualmente usando o seguinte procedimento:


NOTE: Essas etapas não serão necessárias se as ONTAP tools for VMware vSphere 10.1 ou 10.2 estiverem em configurações pequenas ou médias (caminho local) não HA.

. No vCenter Server, abra um console para ferramentas ONTAP .
. Efetue login como usuário de manutenção.
. Digite *4* para selecionar o menu *Suporte e Diagnóstico*.
. Digite *1* para selecionar a opção *Access diagnostics shell*.
. Execute o seguinte comando
+
[listing]
----
sudo python3 /home/maint/scripts/ontap_cleanup.py
----
. Digite o nome de usuário e a senha do ONTAP


Isso exclui todos os volumes Trident no ONTAP usados ​​nas ONTAP tools for VMware vSphere 10.1/10.2.

.Informações relacionadas
link:../migrate/migrate-to-latest-ontaptools.html["Migrar das ONTAP tools for VMware vSphere 9.xx para 10.4"]
